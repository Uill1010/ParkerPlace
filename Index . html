<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ParkerPlace - Marketplace</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f7f7f7;
    margin: 0; padding: 0;
  }
  header {
    background: #005a87;
    color: white;
    padding: 15px 20px;
    text-align: center;
  }
  main {
    max-width: 600px;
    margin: 30px auto;
    background: white;
    padding: 20px;
    border-radius: 6px;
    box-shadow: 0 0 8px rgba(0,0,0,0.1);
  }
  h1, h2 {
    margin-top: 0;
  }
  input[type="text"], input[type="password"], input[type="number"], select, textarea {
    width: 100%;
    padding: 8px;
    margin: 6px 0 12px;
    border: 1px solid #ccc;
    border-radius: 4px;
  }
  button {
    background: #007acc;
    color: white;
    border: none;
    padding: 10px 15px;
    cursor: pointer;
    border-radius: 4px;
    font-weight: bold;
    margin-top: 10px;
  }
  button:disabled {
    background: #999;
    cursor: not-allowed;
  }
  .hidden {
    display: none;
  }
  nav {
    margin-bottom: 15px;
  }
  nav button {
    margin-right: 10px;
    background: #eee;
    color: #333;
    font-weight: normal;
  }
  nav button.active {
    background: #007acc;
    color: white;
    font-weight: bold;
  }
  .message {
    background: #e7f3ff;
    border: 1px solid #a7d0ff;
    padding: 10px;
    border-radius: 4px;
    margin-bottom: 15px;
    color: #005a87;
  }
  .pix-info {
    background: #fffae7;
    border: 1px solid #ffecb3;
    padding: 15px;
    border-radius: 6px;
    font-weight: bold;
    text-align: center;
    margin-bottom: 20px;
  }
  .anuncios-list {
    margin-top: 20px;
  }
  .anuncio-item {
    border-bottom: 1px solid #ddd;
    padding: 10px 0;
  }
  .footer {
    text-align: center;
    font-size: 0.9em;
    color: #666;
    margin-top: 30px;
    padding-bottom: 20px;
  }
  #comprovante-preview {
    max-width: 200px;
    margin: 10px auto;
    display: block;
    border: 1px solid #ccc;
    border-radius: 6px;
  }
</style>
</head>
<body>

<header>
  <h1>ParkerPlace</h1>
  <p>Marketplace criado por Uilliam Santos da Silva</p>
</header>

<main>

  <!-- Área de login e cadastro -->
  <section id="login-section">
    <h2>Login / Cadastro</h2>
    <input type="text" id="input-username" placeholder="Digite seu usuário (e-mail)" autocomplete="username" />
    <input type="password" id="input-password" placeholder="Digite sua senha" autocomplete="current-password" />
    <button id="btn-login">Entrar</button>
    <button id="btn-register">Cadastrar</button>
    <div id="login-message" class="message hidden"></div>
  </section>

  <!-- Área do painel do usuário -->
  <section id="user-panel" class="hidden">

    <nav>
      <button id="btn-anunciar" class="active">Anunciar</button>
      <button id="btn-meus-anuncios">Meus anúncios</button>
      <button id="btn-sair">Sair</button>
    </nav>

    <!-- Informação pagamento / assinatura -->
    <div id="payment-info" class="pix-info hidden">
      Para assinar o pacote mensal de <strong>R$ 25,00</strong> e liberar anúncios, faça o pagamento no Pix:<br /><br />
      <code>uilliamsantos298@gmail.com</code>
      <br /><br />
      Após o pagamento, envie o comprovante abaixo.<br /><br />
      <button id="btn-confirm-payment">Já paguei, enviar comprovante</button>
      <div id="comprovante-form" class="hidden">
        <input type="file" id="comprovante-input" accept="image/*" />
        <button id="btn-enviar-comprovante">Enviar comprovante</button>
        <img id="comprovante-preview" class="hidden" />
        <div id="comprovante-status" class="message hidden"></div>
      </div>
    </div>

    <!-- Formulário para anunciar -->
    <section id="anunciar-section" >
      <h2>Faça seu anúncio</h2>

      <label>Segmento</label>
      <select id="select-segmento" >
        <option value="" disabled selected>Selecione o segmento</option>
        <option>Ativos</option>
        <option>Máquinas</option>
        <option>Usinas</option>
        <option>Implementos Agrícolas</option>
        <option>Grãos</option>
        <option>Minério</option>
        <option>Ouro</option>
        <option>Outros</option>
      </select>

      <label>Título do anúncio</label>
      <input type="text" id="input-titulo" placeholder="Título do seu anúncio" />

      <label>Descrição</label>
      <textarea id="input-descricao" rows="4" placeholder="Descrição detalhada"></textarea>

      <label>Preço (R$)</label>
      <input type="number" id="input-preco" placeholder="Valor do produto ou serviço" min="0" step="0.01" />

      <button id="btn-publicar">Publicar anúncio</button>
      <div id="anunciar-message" class="message hidden"></div>
    </section>

    <!-- Lista dos anúncios -->
    <section id="meus-anuncios-section" class="hidden">
      <h2>Meus anúncios</h2>
      <div id="anuncios-list" class="anuncios-list">
        <!-- Anúncios vão aparecer aqui -->
      </div>
    </section>

  </section>

</main>

<div class="footer">
  ParkerPlace © 2025 - Criado por Uilliam Santos da Silva
</div>

<script>
  // "Banco" local para usuários e anúncios via localStorage
  const usersDB = JSON.parse(localStorage.getItem("parkerplace-users") || "{}");
  const anunciosDB = JSON.parse(localStorage.getItem("parkerplace-anuncios") || "{}");

  let currentUser = null;

  // ---- UTILITÁRIOS ----
  function showMessage(id, msg, timeout = 3000) {
    const el = document.getElementById(id);
    el.textContent = msg;
    el.classList.remove("hidden");
    if (timeout > 0) setTimeout(() => el.classList.add("hidden"), timeout);
  }

  function saveDBs() {
    localStorage.setItem("parkerplace-users", JSON.stringify(usersDB));
    localStorage.setItem("parkerplace-anuncios", JSON.stringify(anunciosDB));
  }

  function clearAnunciarForm() {
    document.getElementById("select-segmento").value = "";
    document.getElementById("input-titulo").value = "";
    document.getElementById("input-descricao").value = "";
    document.getElementById("input-preco").value = "";
    document.getElementById("anunciar-message").classList.add("hidden");
  }
  function clearLoginForm() {
    document.getElementById("input-username").value = "";
    document.getElementById("input-password").value = "";
    document.getElementById("login-message").classList.add("hidden");
  }

  // ---- LOGIN / CADASTRO ----
  document.getElementById("btn-login").onclick = () => {
    const user = document.getElementById("input-username").value.trim().toLowerCase();
    const pass = document.getElementById("input-password").value;

    if(!user || !pass) {
      showMessage("login-message", "Preencha usuário e senha.");
      return;
    }
    if(!usersDB[user]) {
      showMessage("login-message", "Usuário não cadastrado.");
      return;
    }
    if(usersDB[user].password !== pass) {
      showMessage("login-message", "Senha incorreta.");
      return;
    }
    currentUser = usersDB[user];
    localStorage.setItem("parkerplace-current-user", user); // persistência de sessão
    clearLoginForm();
    showUserPanel();
  };

  document.getElementById("btn-register").onclick = () => {
    const user = document.getElementById("input-username").value.trim().toLowerCase();
    const pass = document.getElementById("input-password").value;

    if(!user || !pass) {
      showMessage("login-message", "Preencha usuário e senha.");
      return;
    }
    if(usersDB[user]) {
      showMessage("login-message", "Usuário já existe.");
      return;
    }
    usersDB[user] = {
      username: user, // CORRIGIDO!
      password: pass,
      pagaAssinatura: false,
      dataPagamento: null,
      comprovantePix: null
    };
    saveDBs();
    showMessage("login-message", "Cadastro realizado com sucesso! Agora faça login.");
    clearLoginForm();
  };

  // ---- PAINEL DO USUÁRIO ----
  function showUserPanel() {
    document.getElementById("login-section").classList.add("hidden");
    document.getElementById("user-panel").classList.remove("hidden");
    updatePaymentStatus();
    showSection("anunciar-section");
    updateAnunciosList();
  }

  // Pagamento / assinatura
  function updatePaymentStatus() {
    const pagamento = currentUser.pagaAssinatura;
    const hoje = new Date();
    let habilitaAnunciar = false;

    if(pagamento && currentUser.dataPagamento) {
      const dtPagamento = new Date(currentUser.dataPagamento);
      // Verifica se está dentro dos 30 dias
      const diff = hoje - dtPagamento;
      if(diff <= 30*24*60*60*1000) {
        habilitaAnunciar = true;
      } else {
        currentUser.pagaAssinatura = false;
        currentUser.dataPagamento = null;
        saveDBs();
        showMessage("anunciar-message", "Assinatura expirada. Renove para continuar anunciando.", 4000);
      }
    }

    if(habilitaAnunciar) {
      document.getElementById("payment-info").classList.add("hidden");
      document.getElementById("btn-publicar").disabled = false;
    } else {
      document.getElementById("payment-info").classList.remove("hidden");
      document.getElementById("btn-publicar").disabled = true;
      // Se já enviou comprovante, mostra status aguardando
      if(currentUser.comprovantePix) {
        document.getElementById("btn-confirm-payment").classList.add("hidden");
        document.getElementById("comprovante-form").classList.remove("hidden");
        document.getElementById("comprovante-input").classList.add("hidden");
        document.getElementById("btn-enviar-comprovante").classList.add("hidden");
        document.getElementById("comprovante-preview").classList.remove("hidden");
        document.getElementById("comprovante-preview").src = currentUser.comprovantePix;
        showMessage("comprovante-status", "Comprovante enviado! Aguarde a liberação da assinatura.", 0);
      } else {
        document.getElementById("btn-confirm-payment").classList.remove("hidden");
        document.getElementById("comprovante-form").classList.add("hidden");
      }
    }
  }

  // Fluxo de envio de comprovante
  document.getElementById("btn-confirm-payment").onclick = () => {
    document.getElementById("btn-confirm-payment").classList.add("hidden");
    document.getElementById("comprovante-form").classList.remove("hidden");
    document.getElementById("comprovante-input").classList.remove("hidden");
    document.getElementById("btn-enviar-comprovante").classList.remove("hidden");
    document.getElementById("comprovante-preview").classList.add("hidden");
    document.getElementById("comprovante-status").classList.add("hidden");
  };

  // Envio do comprovante (salva no navegador!)
  document.getElementById("btn-enviar-comprovante").onclick = () => {
    const input = document.getElementById("comprovante-input");
    if (!input.files || !input.files[0]) {
      showMessage("comprovante-status", "Selecione uma imagem do comprovante!");
      return;
    }
    const reader = new FileReader();
    reader.onload = function(e) {
      if(currentUser) {
        usersDB[currentUser.username].comprovantePix = e.target.result;
        saveDBs();
        document.getElementById("comprovante-preview").src = e.target.result;
        document.getElementById("comprovante-preview").classList.remove("hidden");
        document.getElementById("comprovante-input").classList.add("hidden");
        document.getElementById("btn-enviar-comprovante").classList.add("hidden");
        showMessage("comprovante-status", "Comprovante enviado! Aguarde a liberação da assinatura.", 0);
      }
    };
    reader.readAsDataURL(input.files[0]);
  };

  // Navegação painel
  document.getElementById("btn-anunciar").onclick = () => {
    showSection("anunciar-section");
    clearAnunciarForm();
  };
  document.getElementById("btn-meus-anuncios").onclick = () => {
    showSection("meus-anuncios-section");
    updateAnunciosList();
  };
  document.getElementById("btn-sair").onclick = () => {
    currentUser = null;
    localStorage.removeItem("parkerplace-current-user");
    document.getElementById("user-panel").classList.add("hidden");
    document.getElementById("login-section").classList.remove("hidden");
    clearLoginForm();
  };

  function showSection(id) {
    const anunciar = document.getElementById("anunciar-section");
    const meus = document.getElementById("meus-anuncios-section");
    if(id === "anunciar-section") {
      anunciar.classList.remove("hidden");
      meus.classList.add("hidden");
      document.getElementById("btn-anunciar").classList.add("active");
      document.getElementById("btn-meus-anuncios").classList.remove("active");
    } else {
      anunciar.classList.add("hidden");
      meus.classList.remove("hidden");
      document.getElementById("btn-anunciar").classList.remove("active");
      document.getElementById("btn-meus-anuncios").classList.add("active");
    }
  }

  // ---- ANÚNCIOS ----
  document.getElementById("btn-publicar").onclick = () => {
    const segmento = document.getElementById("select-segmento").value;
    const titulo = document.getElementById("input-titulo").value.trim();
    const descricao = document.getElementById("input-descricao").value.trim();
    const preco = document.getElementById("input-preco").value.trim();

    if(!segmento || !titulo || !descricao || !preco) {
      showMessage("anunciar-message", "Preencha todos os campos para publicar.");
      return;
    }

    // Validação preço
    if(isNaN(preco) || Number(preco) < 0) {
      showMessage("anunciar-message", "Preço inválido.");
      return;
    }

    if(!currentUser.pagaAssinatura) {
      showMessage("anunciar-message", "Você precisa pagar a assinatura para anunciar.");
      return;
    }

    // Cria o anúncio
    if(!anunciosDB[currentUser.username]) {
      anunciosDB[currentUser.username] = [];
    }
    anunciosDB[currentUser.username].push({
      segmento,
      titulo,
      descricao,
      preco: Number(preco).toLocaleString('pt-BR', {minimumFractionDigits: 2}),
      data: new Date().toLocaleDateString()
    });
    saveDBs();
    clearAnunciarForm();
    showMessage("anunciar-message", "Anúncio publicado com sucesso!");
    updateAnunciosList();
  };

  function updateAnunciosList() {
    const container = document.getElementById("anuncios-list");
    container.innerHTML = "";
    const anuncios = anunciosDB[currentUser.username] || [];
    if(anuncios.length === 0) {
      container.innerHTML = "<p>Nenhum anúncio publicado.</p>";
      return;
    }
    anuncios.forEach((a, i) => {
      const div = document.createElement("div");
      div.classList.add("anuncio-item");
      div.innerHTML = `
        <strong>${a.titulo}</strong> (${a.segmento}) - R$ ${a.preco} <br />
        <em>${a.descricao}</em><br />
        <small>Publicado em: ${a.data}</small>
      `;
      container.appendChild(div);
    });
  }

  // ---- LOGIN AUTOMÁTICO (opcional) ----
  window.addEventListener("DOMContentLoaded", () => {
    const lastUser = localStorage.getItem("parkerplace-current-user");
    if(lastUser && usersDB[lastUser]) {
      currentUser = usersDB[lastUser];
      showUserPanel();
    }
  });
</script>

</body>
</html>